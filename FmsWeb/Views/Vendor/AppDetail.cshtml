@using FmsWeb.Model
<script src="@Url.Content("~/Scripts/common.js")" type="text/javascript"></script>
<script src="http://cdn.jquerytools.org/1.2.7/full/jquery.tools.min.js"></script>
<script type="text/javascript">
    var dd;
    function VendorTc2Response(result) {

        var message = "";
        if (result) {
            message = "Are you sure you want to mark this testing as PASSED";
        } else {
            message = "Are you sure you want to mark this testing as FAILED";
        }
        var retVal = confirm(message);
        
        var discoveryUpdate = $('input[@@name="discoveryUpdate"]:checked').val();
        
        if (retVal == true) {
            var url = "/FMS/VendorTc2Response/?transactionId=" + GlobalTransactionId;
            var nextAction = "Done!!";
            $('#UserResponse').hide();
            $('#Continue').html("<img src='/Content/images/loader.gif'>");


            $.post(url, { feed: $("#feed").val(), passed: result, discoveryFeedRequiresUpdate : discoveryUpdate }, function(submission) {

                if (submission == "undefined") {
                    var status = submission.Statuses[submission.Statuses.length - 1];

                    if (!status.Pass) {
                        nextAction = "Failed!!";
                    }

                    DisplayFeed(submission.Feed, nextAction);
                } else {
                    DisplayFeed($("#feed").val(), nextAction);
                }

            }).complete(function() {
                keepTracking = false;
                ShowStatus(GlobalTransactionId);
                ShowErrors(GlobalTransactionId);
            });
        }

    }

    function WorkFlow(workFlowInstanceId, title) {
        var div = $('#Title');
        div.html("<h2>" + title + "</h2>");
        $.getJSON("/FMS/WorkflowDetail/?workFlowInstanceId=" + workFlowInstanceId, null, function (data) {
            GlobalTransactionId = data.TransactionId;
            ShowStatus(data.TransactionId);
            ShowErrors(data.TransactionId);
            $("#feed").val(data.Feed);
            DisplayCommentSection();
        });


    }
    
    $(function () {
        $("ul.tabs").tabs("div.panes > div");
    });

</script>

<table style="vertical-align: top; border-width: 0px;">

    <tr>
        <td style="vertical-align: top; border-width: 0px; width: 300px;">
            <img style="vertical-align:top;border-width:0px;" height="55" alt="EC-CUBE" src="http://www.microsoft.com/web/handlers/webpi.ashx?command=getimage&guid=@Model.ImageGuid"/>
            <br />
            <h2>@Model.NickName, @Model.Version</h2>

            <br />
            <br />




        </td>
        <td style="vertical-align: top; border-width: 0px;">
            <table style="vertical-align: top; border-width: 0px;">
                <tr>
                    <td style="vertical-align: top; border-width: 0px; width: 950px;">

                        <div id="Continue">
                            <table>
                                <tr>
                                    <td>Discovery Feed Update Required </td>
                                    <td>
                                        <INPUT TYPE="radio" name="discoveryUpdate" VALUE="true"> Yes  <INPUT TYPE="radio" name="discoveryUpdate" checked VALUE="false">No
                                    </td>
                                </tr>
                                 <tr>
                                    <td>Validation</td>
                                     <td>
                                         <INPUT TYPE="button" onClick="VendorTc2Response(true)" VALUE="Pass"> <INPUT TYPE="button" onClick="    VendorTc2Response(false)" VALUE="Fail">
                                     </td>
                                </tr>
                            </table>
                                                                                                                            
                        </div>

                        <div id="Title">
                        </div>

                        <div class="box">
                            <!-- the tabs -->
                            <ul class="tabs">
                                <li><a href="#">Status</a></li>
                                <li><a href="#">Feed</a></li>
                                <li><a href="#">Comments</a></li>
                            </ul>

                            <!-- tab "panes" -->

                            <div class="panes">

                                <div>
                                    <span id="status"></span>
                                </div>
                                <div>
                                    <span id="UserResponse">
                                        <textarea id="feed" style="vertical-align: top; width: 100%; height: 600px;"></textarea>
                                    </span>
                                </div>
                                <div>
                                    @Html.Partial("_Comments")
                                </div>
                            </div>

                        </div>

                    </td>
                </tr>
            </table>

        </td>
    </tr>
</table>
